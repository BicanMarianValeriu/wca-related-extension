{"version":3,"sources":["webpack:///./src/js/RelatedEntries.js"],"names":["wecodeart","Component","Template","isEven","value","addTemplate","entry","title","link","dateOpts","date_gmt","imageURL","featured_media","url","author","name","avatar","options","year","month","day","lang","document","documentElement","getAttribute","date","Date","attrMatcher","postHTML","createElement","className","style","backgroundImage","innerHTML","rendered","toLocaleDateString","replace","pluginDefaults","path","postId","query","amount","template","observer","root","rootMargin","threshold","afterFetching","data","element","classes","loaded","loading","hideIfEven","e","classList","add","remove","map","i","querySelector","children","replaceWith","render","length","querySelectorAll","forEach","RelatedEntries","el","Object","assign","defaults","_elements","push","_setupEventHandlers","getInstance","_removeEventHandlers","index","indexOf","splice","undefined","theObserver","IntersectionObserver","shift","isIntersecting","get","then","d","catch","console","warn","unobserve","observe","els","domElem","jquery","wp","apiFetch","addQueryArgs","plugins","apply","window"],"mappings":"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","file":"js/RelatedEntries.js","sourcesContent":["/**\n * RelatedEntries JS Plugin\n * @author \t\tBican Marian Valeriu\n * @license \thttps://www.wecodeart.com/\n * @uses\t\tComponent Class\n * @uses\t\tTemplate Class\n */\n\nexport default (function (wecodeart) {\n\n\tconst { Component, Template } = wecodeart;\n\n\tconst isEven = (value) => {\n\t\tif (value % 2 == 0) return true;\n\t\telse return false;\n\t};\n\n\t// Add Related Template\n\tTemplate.addTemplate('related-post', (entry) => {\n\t\tconst {\n\t\t\ttitle,\n\t\t\tlink,\n\t\t\tdate_gmt: dateOpts,\n\t\t\tfeatured_media: {\n\t\t\t\turl: imageURL\n\t\t\t},\n\t\t\tauthor: {\n\t\t\t\tname,\n\t\t\t\tavatar\n\t\t\t},\n\t\t\toptions = { year: 'numeric', month: 'long', day: 'numeric' },\n\t\t\tlang = document.documentElement.getAttribute('lang') || 'en-US'\n\t\t} = entry;\n\n\t\tconst date = new Date(dateOpts);\n\t\tconst attrMatcher = /(?:class *= *[\\'\\\"]{0,1})((?:[\\w -](?!\\w+=|\\/))+)[\\'\\\"]*/gi;\n\n\t\tconst postHTML = document.createElement('article');\n\t\tpostHTML.className = 'related-posts__item related-post related-post--js col-12 col-md-6';\n\t\tpostHTML.style.backgroundImage = `url('${imageURL}')`;\n\t\tpostHTML.innerHTML = `\n\t\t\t<a href=\"${link}\" class=\"related-post__body position-relative d-block p-3 p-md-4\">\n\t\t\t\t<h4 class=\"related-post__title font-weight-bold mb-1 text-truncate\">${title.rendered}</h4>\n\t\t\t\t<p class=\"related-post__date mb-2 text-primary\">\n\t\t\t\t\t<i class=\"fal fa-clock me-2\"></i>\n\t\t\t\t\t<time class=\"text-muted\" datetime=\"${dateOpts}\">${date.toLocaleDateString(lang, options)}</time>\n\t\t\t\t</p>\n\t\t\t\t<p class=\"related-post__author mb-0\">\n\t\t\t\t\t${avatar.replace(attrMatcher, 'class=\"related-post__avatar rounded-circle d-inline-block mr-2\"')}\n\t\t\t\t\t<span class=\"font-weight-bold text-dark\">by ${name}</span>\n\t\t\t\t</p>\n\t\t\t</a> \n\t\t`;\n\n\t\treturn postHTML;\n\t});\n\n\t// Set Defaults\n\tconst pluginDefaults = {\n\t\tpath: '/wp/v2/posts',\n\t\tpostId: 0,\n\t\tquery: {\n\t\t\tamount: 4,\n\t\t},\n\t\ttemplate: 'related-post',\n\t\tobserver: {\n\t\t\troot: null,\n\t\t\trootMargin: '0px',\n\t\t\tthreshold: 0\n\t\t},\n\t\tafterFetching: (data, options) => {\n\t\t\tconst { Template } = wecodeart;\n\t\t\tconst { element, template, classes: { loaded, loading } } = options;\n\t\t\tconst hideIfEven = e => e.classList.add('d-none');\n\t\t\telement.classList.remove(loading);\n\t\t\tdata.map((e, i) => element.querySelector('.row').children[i].replaceWith(Template.render(template, e)));\n\t\t\tif (isEven(data.length)) {\n\t\t\t\telement.querySelectorAll('.related-post:not(.related-post--js)').forEach(hideIfEven);\n\t\t\t}\n\t\t\telement.classList.add(loaded);\n\t\t},\n\t\tclasses: {\n\t\t\tloading: 'js--is-loading',\n\t\t\tloaded: 'js--loaded',\n\t\t},\n\t};\n\n\t/**\n\t * @class\n\t */\n\tclass RelatedEntries extends Component {\n\t\t/**\n\t\t * Construct Animate instance\n\t\t * @constructor\n\t\t * @param {Element} el\n\t\t * @param {Object} options\n\t\t */\n\t\tconstructor(el, options) {\n\t\t\tsuper(RelatedEntries, el, options);\n\t\t\tthis.el.RelatedEntries = this;\n\t\t\t/**\n\t\t\t * Options for the animation\n\t\t\t * @member RelatedEntries#options\n\t\t\t */\n\t\t\tthis.options = Object.assign({}, RelatedEntries.defaults, {\n\t\t\t\telement: this.el,\n\t\t\t}, options);\n\t\t\tRelatedEntries._elements.push(this);\n\t\t\tthis._setupEventHandlers();\n\t\t}\n\n\t\tstatic get defaults() {\n\t\t\treturn pluginDefaults;\n\t\t}\n\n\t\tstatic init(els, options) {\n\t\t\treturn super.init(this, els, options);\n\t\t}\n\n\t\t/**\n\t\t * Get Instance\n\t\t */\n\t\tstatic getInstance(el) {\n\t\t\tconst domElem = el.jquery ? el[0] : el;\n\t\t\treturn domElem.RelatedEntries;\n\t\t}\n\n\t\t/**\n\t\t * Teardown component\n\t\t */\n\t\tdestroy() {\n\t\t\tif (RelatedEntries.getInstance(this.el)) {\n\t\t\t\tthis._removeEventHandlers();\n\t\t\t\tconst index = RelatedEntries._elements.indexOf(this);\n\t\t\t\tRelatedEntries._elements.splice(index, 1);\n\t\t\t\tthis.el.RelatedEntries = undefined;\n\t\t\t}\n\t\t}\n\n\t\t_removeClasses() {\n\t\t\t// IE 11 bug (can't remove multiple classes in one line)\n\t\t\tthis.el.classList.remove(this.options.classes.loaded);\n\t\t}\n\n\t\t/**\n\t\t * Setup Events\n\t\t */\n\t\t_setupEventHandlers() {\n\t\t\tconst { postId, afterFetching, classes: { loading }, query, observer } = this.options;\n\t\t\tconst theObserver = new IntersectionObserver((el) => {\n\t\t\t\tif (el.shift().isIntersecting) {\n\t\t\t\t\tthis.el.classList.add(loading);\n\t\t\t\t\tRelatedEntries.get({ postId, query }).then(d => afterFetching(d, this.options)).catch(e => console.warn(e));\n\t\t\t\t\ttheObserver.unobserve(this.el);\n\t\t\t\t}\n\t\t\t}, observer);\n\t\t\ttheObserver.observe(this.el);\n\t\t}\n\n\t\t/**\n\t\t * Remove Event Handlers\n\t\t */\n\t\t_removeEventHandlers() {\n\t\t\tif (RelatedEntries.getInstance(this.el)) {\n\t\t\t\t// DO stuff\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Retrieves events for a date range\n\t\t *\n\t\t * @param {object} options\n\t\t */\n\t\tstatic async get({ postId, query: data }) {\n\t\t\tconst { apiFetch, url: { addQueryArgs } } = wp;\n\t\t\tconst { path } = RelatedEntries.defaults;\n\t\t\treturn await apiFetch({ path: addQueryArgs(`${path}/${postId}/related`, data) });\n\t\t}\n\t}\n\n\t/**\n\t * @static\n\t * @memberof RelatedEntries\n\t */\n\tRelatedEntries._elements = [];\n\twecodeart.plugins.RelatedEntries = RelatedEntries;\n\n}).apply(this, [window.wecodeart]);"],"sourceRoot":""}